(function(z){
'use strict';var soa=function(a,b){this.user=a;this.quotes=b},w4=function(a){return a.rx.best||null},x4=function(a,b){b=b.filter(function(a){return"anon"!=a.Oa()});var c=z.mb(b,function(a){return a.Oa()},a);return z.tb(c).map(function(a){return new soa(a[0].tc(),a)},a)},toa=function(a,b,c,d){return(0,z.qd)(a.Ln[b.name]||[],function(a){return a.ac()==c&&a.Oc()==d})},y4=function(a){return z.y(a,"inResponseToMediaResource")},z4=function(a){return z.y(a,"mediumQuote")},A4=function(a,b){return w4(a)?z.BH(w4(a)).filter(function(a){return this.TL(a)==
b},a):[]},B4=function(a,b,c){var d=z.w(a.l,z.MP,{postId:b},{filter:c});return z.jM(a,d,function(){return this.Ja.nr(d)})},uoa=function(a){z.WB(a.sa,z.Wm("",a.Lo()))},voa=function(a,b,c){c=c.qr;b=b.getAttribute("name").split(" ");var d=z.Fb(b);a=(a.Ln[c.name]||[]).filter(function(a){return d[a.mg()]});return a.length?z.GH(a):null},woa=function(a,b,c,d){b=toa(a,b,c,d);return x4(a,b)},xoa=function(a,b){var c=0;(a.Ln[b]||[]).forEach(function(a){"anon"==a.Oa()&&(c+=a.bd())});return c},C4=function(a){return z.y(a,
"replies")},yoa=function(a,b){z.Jq(a,7);var c=new z.zq("",1,a.ba());b.forEach(function(a){z.Hq(c,z.Xq(a.startOffset,a.endOffset,[a.quoteId],[a.userId]))},a);for(var d=z.Tq(c),e=z.Uq(c,d),g=0;g<d.length;g++){var h=e[g];if(h.length){for(var k={},n=[],p=0;p<h.length;p++){var v=h[p];k[z.y(v,"creatorIds")]=!0;n.push(v.getName())}h=d[g];p=g<d.length-1?d[g+1]:a.ba().length;z.Hq(a,z.Xq(h,p,n,Object.keys(k)))}}},D4=function(a,b,c){b=z.C;a=a.Haa?"Top highlight":(0,z.C)(z.I(z.rS(z.F(a,{QM:!0,KY:!c.useragent.isMobile}),
c))+(1==a.Vf&&a.isActive?" highlighted":""));return b(a)},E4=function(a,b){this.Ef=a;this.s1=b;var c=z.QD(a.node,b);this.Vc=(this.Bh=c)&&c.getAttribute("name");this.aC=c?z.ox(a,c):-1},zoa=function(a,b,c){return(0,z.C)(z.PY(z.F(a,{user:c.currentUser,type:"quoteResponses"}),c))},Aoa=function(a,b,c){return(0,z.C)('\x3cdiv\x3e\x3cdiv class\x3d"buttonSet buttonSet--highlightMenu"\x3e'+z.I(z.MA({action:"quote",source:"quote_popover",icon:"icon--highlighter",H:"button--highlightMenu js-quoteAttributions-pileOn",
Tb:!0,$i:!0,UK:"quote",ga:!0,isActive:a.isActive},c))+(c.supportsEdit?z.I(z.oz({action:"quote-respond",source:"quote_popover",icon:(0,z.P)(""+z.I(z.hA({size:"25px"},c))),H:"button--highlightMenu",Tb:!0,ga:!0},c)):"")+'\x3cdiv class\x3d"buttonSet-separator"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"js-quoteAttributions-info quoteAttributions-info"\x3e'+D4(a,0,c)+"\x3c/div\x3e\x3c/div\x3e")},F4=function(a){z.Zd.call(this);var b=z.fi();this.bh=b&&new E4(z.nj(b,!0),a);this.wi=b&&new E4(z.nj(b,!1),
a)},G4=function(a,b,c){z.U.call(this);this.zc=a.get("quotes-data");var d=this.zc.$g;d.subscribe("add",this.OS,this);d.subscribe("remove",this.OS,this);this.Ba=b;this.Gc=b.ri;this.pk=c;this.dQ=[];this.sa=a.get("app");this.ia=a.get("popover");this.l=a.get("route-builder");this.LH=a.get("global-event-bus");this.z6=a.get("progressive-media-loader")},J4=function(a,b,c,d){var e=H4(a,b);e&&(c=z.NF(z.PF(z.MF(z.OF(z.LF(a.ia).Ta(Aoa,e),"top"),c),"popover--dark popover--padding0 popover--flexible popover--quoteAttributions"),
d).S())&&(c.Qg("deactivate",function(){this.Xl===b&&I4(this,null)},a),z.FF(c).o("quote",a.i2.bind(a,c)).o("quote-respond",a.j2.bind(a,c)))},H4=function(a,b){if("anon"==b.Oa())return{isActive:!1,Haa:!0};var c=K4(a,b),d=b.ac(),e=b.Oc(),c=woa(a.zc,c,d,e);if(!c||!c.length)return null;c=(0,z.Ib)(c,function(a){return a.user});d=(0,z.qd)(c,function(a){return a.userId!=z.Kk().userId});return{isActive:(0,z.dd)(c,function(a){return a.userId==z.Kk().userId}),social:d,Vf:c.length}},Boa=function(a,b){var c=a.Gc.querySelectorAll('.markup--quote[name~\x3d"'+
b.mg()+'"]');return z.ab(c)},K4=function(a,b){var c=b.pb()[0].name;return(c=z.Rw(a.Gc,c))?a.Ba.kg(c):null},L4=function(a,b){var c=z.gi(b);return(c=z.RH(a.pk,c))?voa(a.zc,b,c):null},I4=function(a,b){a.Xl!==b&&(a.Xl&&M4(a,a.Xl,!1),b&&M4(a,b,!0),a.Xl=b)},M4=function(a,b,c){Boa(a,b).map(function(a){z.td(a,"is-targeted",c)})},N4=function(a,b){var c=b.pb(),d=z.Rw(a.Gc,c[0].getName()),c=z.Rw(a.Gc,z.Qa(c).getName());(d=z.qH(d,b.ac(),c,b.Oc()))&&z.PH(a.nh(),d)},O4=function(a,b,c,d){z.HB(c?z.XP:z.nia,{postId:a.Ba.va(),
quoteId:b,source:d})},Coa=function(a,b){z.TD(a,z.SD,z.$b(b,z.Wb(!0)),void 0)},P4=function(a){z.iy.call(this);this.ib=a.get("dom-model-converter");this.VR={};this.ZQ={};this.eJ={};this.W=a;this.tk=a.get("request");this.l=a.get("route-builder");this.Z=a.get("model-store");this.za="";this.tS=0;this.bQ=!1;this.ui=null},Q4=function(a,b){var c=a.VR[b];c||(c=a.VR[b]=new z.wH,a.X("new_note_list",c,a));return c},Doa=function(a,b){if(!b)return!1;var c=b.ba();if(a.content==c.substring(a.startIndex,a.endIndex))return!0;
var d=new RegExp(z.Ia(a.content),"gi"),e=d.exec(c),c=e&&d.exec(c);return e&&!c?(c=a.endIndex-a.startIndex,a.startIndex=e.index,a.endIndex=e.index+c,a.content=e[0],!0):!1},R4=function(a,b,c){var d=b.va(),e=b.Wd(),g=Q4(a,b.ad()),h=g?g.indexOf(b):-1,k=b.wy();b.hs(c);"HIDDEN"==c?a.Z.remove(b):b=z.iH(a.Z,b);var n=g?g.indexOf(b):-1;return{Sh:a.tk.put(z.w(a.l,z.Ega,{postId:d,noteId:e}),{state:c},{json:!0}),sz:function(){b.hs(k);-1==n&&(-1==h?g.add(b):z.yH(g,b,h))}}},S4=function(a,b,c,d,e,g){var h=C4(a.Uk(c,
e)),k=z.Ra(h,function(a){return a.Ko()==b}),n=h[k];"HIDDEN"==g&&z.Wa(h,k);c=z.w(a.l,z.Hga,{postId:d,noteId:c,replyId:b});a=a.tk.put(c,{state:g},{json:!0});var p=z.Ra(h,function(a){return a.Ko()==b});return{Sh:a,sz:function(){-1==p&&z.db(h,k,0,n)}}},Eoa=function(a,b,c){this.range=a;this.anchor=b;this.Kq=b.getAttribute("name");this.highlight=c},T4=function(){},U4=function(a){this.$B=a},V4=function(a,b){return b?z.Rw(a.$B,b):null},W4=function(a,b,c){Coa(a.$B,function(a){var e=a.getAttribute("name");
e&&b.call(c,a,e)})},X4=function(a,b){return z.Fg(a.$B,b)?a.$B:null},Y4=function(a,b,c,d,e){z.fX.call(this,a,b);this.Ha(new z.uW(c));this.Ha(new z.hY(!1));this.Ha(new z.kY(a));this.Ha(new z.gX);this.Ha(new z.nY(!1));this.Ha(new z.KY(d,!0));this.Zg=!0;this.Di=d;this.tk=a.get("request");this.aa=a.get("dialog");this.OI=e;this.S()},Foa=function(){return(0,z.C)("Write a note…")},Z4=function(a,b,c,d,e){Y4.call(this,a,b,e||"Leave a note",400,d||null);this.za=c;this.l=a.get("route-builder");this.Bd=a.get("notes-data")},
$4=function(a,b,c,d,e,g){Y4.call(this,a,b,"Leave a reply",200,d);this.l=a.get("route-builder");this.Bd=a.get("notes-data");this.za=c;this.KS=g||null;this.Vc=e},Goa=function(a,b,c){var d='\x3cdiv class\x3d"quoteResponses js-quoteResponses"\x3e',e=a.quotes.length,g=a.aj.length||a.OO;b=a.notes.length||a.JF;if(e||g||b){if(e){var e='\x3cdiv class\x3d"quoteResponses-section"\x3e'+z.I(z.oG({title:(0,z.P)(z.I((0,z.C)("Highlights"))+" ("+z.D(a.quotes.length)+")"),xd:!0},c)),h;h={SX:a.quotes,Pda:!0};for(var k=
'\x3cdiv class\x3d"js-quotesList"\x3e'+(h.Pda?"":z.I(z.oG({title:(0,z.P)(""+z.I((0,z.C)("Highlights"))),xd:!0,Bc:(0,z.P)(""+z.I(z.nG({href:(0,z.N)(""+z.K((0,z.hr)("https://medium.com/the-story/introducing-highlights-a4df69e8ed43"))),moreText:"Learn more",bc:!0},c)))},c))),n="list list--quotes list--short"+(h.SX.length?"":" is-empty"),n=(0,z.P)(n),k=k+('\x3cul class\x3d"'+z.J(n)+'"\x3e'),n=h.SX,p=n.length,v=0;v<p;v++){for(var u=n[v],E="",M=u.quotes,O=M.length,S=0;S<O;S++)E+=""+M[S].quoteId+(S!=O-1?
",":"");E=z.H(E);k+='\x3cli class\x3d"list-item list-item--inline" data-quote-ids\x3d"'+z.J(E)+'" data-quote-creator-id\x3d"'+z.J(u.user.userId)+'" data-action\x3d"highlight-quote" data-action-type\x3d"hover"\x3e'+z.I(z.vA(z.F(h,{user:u.user,Bp:!0}),c))+"\x3c/li\x3e"}h=(0,z.C)(k+"\x3c/ul\x3e\x3c/div\x3e");e=e+z.D(h)+"\x3c/div\x3e"}else e="";g?(g='\x3cdiv class\x3d"quoteResponses-section'+(a.OO?" is-withEditor":"")+'"\x3e'+z.I(z.oG({title:(0,z.P)(""+z.I((0,z.C)("Responses"))),xd:!0},c)),a.OO&&c.supportsEdit&&
c.isAuthenticated?(h={},h=(0,z.C)('\x3cdiv class\x3d"js-inlineNewPostControl inlineNewPostControl inlineNewPostControl--quoteResponses blockGroup blockGroup-list"\x3e'+z.PY(z.F(h,{user:c.currentUser,isCollapsed:!0,zr:!0,type:"quoteResponses",pp:(0,z.P)(""+z.I((0,z.C)("Respond here…")))}),c)+"\x3c/div\x3e"),h=z.D(h)):h="",g=g+h+a5(a,0,c)+"\x3c/div\x3e"):g="";d+=e+g;if(a.cca&&b){d+='\x3cdiv class\x3d"quoteResponses-section quoteResponses-section--fullBleed"\x3e';b="";g=a.post.homeCollection;g=""+("Private notes are visible to you"+
(a.post.creator.userId!=c.currentUser.userId?", the author,":"")+" and the editors of "+(g?z.D(g.name):"any publication this story is added\x26nbsp;to")+".");g=(0,z.C)(g);g=""+z.D(g);g=(0,z.P)(g);b+='\x3cspan data-tooltip\x3d"'+z.J(g)+'"\x3eWho can see this?\x3c/span\x3e';g={size:"19px"};e="19px"==g.size?1:0;g=""+(e?z.Yz(z.F(g,{name:"lock",Gb:e}),c):"");g=(0,z.C)(g);b={CO:(0,z.P)(""+z.D(g)),title:(0,z.P)(""+z.I((0,z.C)("Private notes"))),xd:!0,Bc:(0,z.P)(b),H:"heading--privateNotes"};b=(0,z.C)(z.lG(z.F(b,
{ih:(0,z.P)(""+z.mG(b,c)),fba:!0})));b=d+=z.D(b);d=""+('\x3cdiv class\x3d"privateNotes-list js-notesList'+(a.JF?" is-showingNoteEditor":"")+(0==a.notes.length?" is-empty":"")+'"\x3e');g=a.notes;e=g.length;for(h=0;h<e;h++)d+=b5({note:g[h],post:a.post,Mz:a.Mz},0,c);a.JF?(a=a.post.creator,a=(0,z.C)(c.currentUser.userId==a.userId?"Leave yourself a note":"Send "+z.D(a.name)+" a private note…"),a='\x3cdiv class\x3d"privateNotes-actions js-noteActions"\x3e'+z.I(z.lz({action:"show-note-editor",text:(0,z.P)(""+
z.D(a)),H:"privateNotes-prompt"},0,c)),c=(0,z.C)('\x3cdiv class\x3d"privateNotes-editor"\x3e'+z.I(z.wA({user:c.currentUser,Md:!0},c))+'\x3cdiv class\x3d"js-noteEditor"\x3e\x3c/div\x3e\x3cdiv class\x3d"buttonSet"\x3e'+z.I(z.lz({action:"save-note",isPrimary:!0,H:"js-saveNoteButton",text:(0,z.P)(""+z.I((0,z.C)("Send")))},0,c))+z.I(z.lz({action:"hide-note-editor",text:(0,z.P)(""+z.I((0,z.C)("Cancel")))},0,c))+"\x3c/div\x3e\x3c/div\x3e"),c=a+c+"\x3c/div\x3e"):c="";c=(0,z.C)(d+("\x3c/div\x3e"+c));d=b+('\x3cdiv class\x3d"quoteResponses-inner privateNotes"\x3e'+
c+"\x3c/div\x3e\x3c/div\x3e")}}else 0<a.Mv&&(d+='\x3cdiv class\x3d"quoteResponses-section quoteResponses-section--fullBleed quoteResponses-section--tips u-textAlignCenter"\x3e\x3cdiv class\x3d"quoteResponses-section--tipsInner u-alignMiddle"\x3e'+z.I(z.MA({Rb:!0,od:!0,ga:!0,action:"previous-highlight-tip",icon:"icon--arrowLeft",title:"Show previous tip"},c))+"\x3cdiv class\x3d'u-alignBlock quoteResponses-section--tipsContent js-highlightTip'\x3e\x3c/div\x3e"+z.I(z.MA({Rb:!0,od:!0,ga:!0,action:"next-highlight-tip",
icon:"icon--arrowRight",title:"Show next tip"},c))+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e");return(0,z.C)(d+"\x3c/div\x3e")},a5=function(a,b,c){return(0,z.C)(z.I(z.IS({source:"quoteResponses",count:a.aj.length,posts:a.aj,Nb:!0,uc:!0,xf:!0,KM:!0,yba:!0,Uf:!0,be:!0,naa:!0},c)))},b5=function(a,b,c){var d,e=null==a.note.replies?null:a.note.replies.length,g=null==a.note.replyId,h=a.post.creator.userId==c.currentUser.userId,k=a.post.creator.userId==a.note.author.userId;d=a.note.author.userId==c.currentUser.userId;
b=h||(null==a.post.homeCollection?null:a.post.homeCollection.virtuals.permissions.canEditPosts);var n=""+(g?"js-note-item"+(a.note.noteId?" js-note-"+a.note.noteId:""):"js-reply-item"+(a.note.replyId?" js-reply-"+a.note.replyId:"")),n=z.H(n),p="",h='\x3cdiv class\x3d"privateNotes-item '+z.J(n)+' js-note" data-note-id\x3d"'+z.J(a.note.noteId)+'"\x3e'+(g?z.I(z.vA({user:a.note.author},c)):z.I(z.tA({user:a.note.author},c)))+'\x3cdiv class\x3d"privateNotes-authorLockup"\x3e\x3cdiv class\x3d"privateNotes-author"\x3e'+
z.I(z.wz({user:a.note.author},c))+(g||!(h||d||(null==a.post.homeCollection?0:a.post.homeCollection.virtuals.permissions.canEditPosts))||k||a.wW?"":'\x3cspan class\x3d"privateNotes-author--supplemental"\x3e '+z.I((0,z.C)("(Editor)"))+"\x3c/span\x3e")+'\x3c/div\x3e\x3cdiv class\x3d"privateNotes-supplemental"\x3e'+z.I(z.mt(Number(a.note.createdAt),c))+'\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"privateNotes-content js-privateNotesContent"\x3e',k=z.I(z.Fu(String(a.note.content),c)),n=String(k).replace(/(\r\n|\r|\n)/g,
"\x3cbr\x3e"),k=z.an(k,z.dn)?(0,z.C)(n,z.bn(k)):n;d=p+(h+k+"\x3c/div\x3e"+(d?c5({note:a.note,isPrimary:g},c):""));if(g){d+='\x3cdiv class\x3d"privateNotes-replies'+(e?"":" is-empty")+' js-repliesList"\x3e';if(e)for(e=a.note.replies,g=e.length,p=0;p<g;p++)h=e[p],d+=b5({note:h,post:a.post,wW:a.note.author.userId==h.author.userId},0,c);e=d;g="\x3c/div\x3e"+(a.Mz?(0,z.C)('\x3cdiv class\x3d"privateNotes-editor privateNotes-editor--reply"\x3e'+z.I(z.uA({user:c.currentUser,Md:!0},c))+'\x3cdiv class\x3d"js-replyEditor"\x3e\x3c/div\x3e\x3cdiv class\x3d"buttonSet"\x3e'+
z.I(z.lz({action:"save-reply",isPrimary:!0,text:(0,z.P)(""+z.I((0,z.C)("Reply")))},0,c))+z.I(z.lz({action:"hide-reply-editor",text:(0,z.P)(""+z.I((0,z.C)("Cancel")))},0,c))+"\x3c/div\x3e\x3c/div\x3e"):"")+'\x3cdiv class\x3d"privateNotes-actions'+(b?" privateNotes-actions--withDismiss":"")+' u-clearfix"\x3e';d=a.Mz?'\x3cdiv class\x3d"u-floatLeft"\x3e'+(0,z.C)(z.I(z.lz({isPrimary:!0,action:"show-reply-editor",H:"privateNotes-prompt",text:(0,z.P)(""+z.I((0,z.C)("Reply")))},0,c)))+"\x3c/div\x3e":"";d=
e+(g+d+(b?'\x3cdiv class\x3d"u-floatRight"\x3e'+c5({note:a.note,isPrimary:!0,fW:!0},c)+"\x3c/div\x3e":"")+"\x3c/div\x3e")}return(0,z.C)(d+"\x3c/div\x3e")},c5=function(a,b){return(0,z.C)(z.I(z.lz({actionValue:a.isPrimary?a.note.noteId:a.note.replyId,action:a.fW?"dismiss-note":a.isPrimary?"delete-note":"delete-reply",H:"privateNotes-delete js-deleteNote",text:(0,z.P)(""+(a.fW?z.I((0,z.C)("Dismiss note")):z.I((0,z.C)("Delete"))))},0,b)))},Hoa=function(a,b,c){return(0,z.C)(0==a.Te?(1==a.Mv?"People":z.D(a.Mv)+
" people")+' highlighted this passage. You can click on an existing highlight to add to it, like below:\x3cimg class\x3d"quoteResponses-tipAnimation" src\x3d"'+z.J(z.Un(z.Gu("/img/help/highlight-tips-2.gif",c.fp)))+'"\x3e':1==a.Te?'Or, select any passage to create your own highlight and tell the author and others what resonated with you:\x3cimg class\x3d"quoteResponses-tipAnimation" src\x3d"'+z.J(z.Un(z.Gu("/img/help/highlight-tips-1.gif",c.fp)))+'"\x3e':2==a.Te?z.I(z.tz({Zd:!0,Tb:!0,source:"highlight_tip",
s:"Sign in to create a profile",href:(0,z.N)(""+z.K(z.nr(c)))},0,c))+" so that you can save your highlights and share them with others.":"")},d5=function(a,b,c,d,e,g,h,k){z.U.call(this);this.W=a;this.fa=a.get("butter-bar");this.Ba=b;this.Vc=c;this.Vg=e;this.zc=a.get("quotes-data");this.Bd=a.get("notes-data");this.Bg=a.get("responses-data");this.qd=g;this.OI=d;this.uJ=(this.lx=h)?h.mg():null;this.Ud=this.Zc=null;this.ah={};this.hR=!!z.Mk();this.iR=!!z.cl();this.kt=this.hR&&this.iR&&z.YH(b);this.Jl=
null;this.mB=0;this.yT=xoa(this.zc,this.Vc);this.fq=k;this.Wa(this.WG())},e5=function(a){a.Va(".js-block").forEach(function(a){this.la(a,"mouseenter",this.J2,this);this.la(a,"mouseleave",this.uK,this)},a)},f5=function(a){a.Va(".js-note").forEach(function(a){this.la(a,"mouseenter",this.G2,this);this.la(a,"mouseleave",this.uK,this)},a)},g5=function(a,b){var c=a.query(".js-note-"+b);a.ah[b]||(a.ah[b]=new $4(a.W,c.querySelector(".js-replyEditor"),a.Ba.va(),b,a.Vc),z.ly(a,a.ah[b],"saving",a.o5,a),z.ly(a,
a.ah[b],"save",a.j5,a),z.ly(a,a.ah[b],"fail",a.q4,a));z.t(c,"is-noteEditorVisible");a.ah[b].focus()},h5=function(a,b){var c=a.ah[b];c&&(c.Ca()&&c.Qd(""),c=a.query(".js-note-"+b),z.rd(c,"is-noteEditorVisible"))},i5=function(a,b,c){var d=V4(a.qd,a.Vc);if(d){var e=[];a.fq&&(e=a.fq.quotes.map(function(a){return a.mg()}));(0,z.Ib)(d.querySelectorAll(".markup--quote"),function(a){var d=a.getAttribute("data-creator-ids").split(" "),d=z.Va(d,b);if(this.fq)var k=a.getAttribute("name").split(" "),d=d&&(0,z.dd)(k,
z.Va.bind(null,e));z.td(a,"is-selected",c&&d)},a)}},j5=function(a){return(a=z.Fw(a,function(a){return z.od(a,"js-note-item")}))&&a.getAttribute("data-note-id")},Ioa=function(a,b,c,d){b=new z.wF(b,300);b.Wa(c);b.subscribe("dismiss",d,a);b.S();return b},k5=function(a){var b=a.pb(),c=a.ac();a=a.Oc();1<b.length&&(a=b[0].ba().length);var d=new z.Ut;d.Ur(b[0].getName());d.kf(c);z.A(d,"endIndex",a);d.Qd(b[0].ba().substring(c,a));return d},l5=function(a,b){var c=b%3;0>c&&(c=2);a.mB=c;(c=a.query(".js-highlightTip"))&&
z.R(c,Hoa,{Te:a.mB,Mv:a.yT})},m5=function(a,b,c,d){z.U.call(this);this.Wa(this.WG(d));this.cb=a.get("dom-monitor");this.Ba=b;this.mR=!b.Sa().km()||b.ed();this.za=b.va();this.qd=c;this.zc=a.get("quotes-data");this.Bg=a.get("responses-data");this.Bd=a.get("notes-data");this.Sp=null;this.pf={}},o5=function(a,b){b.forEach(function(a){a&&n5(this,a)},a)},n5=function(a,b){if(!a.Sp)if(V4(a.qd,b)){var c=Joa(a,b),c=Koa(a,c),c=p5(a,c),c=q5(a,c);a.pf[b]=c;r5(a,b)}else delete a.pf[b]},s5=function(a,b){if(!a.Sp){var c=
a.pf[b];if(c){var d=c.length,c=p5(a,c),c=q5(a,c);a.pf[b]=c;d!=c.length?r5(a,b):c.forEach(function(a){a.oa&&a.offsetTop&&(a.oa.style.top=a.offsetTop+"px")})}}},Loa=function(a,b,c){return z.Sa(a.pf[b]||[],function(a){return a.oa==c})},Joa=function(a,b){var c=[];Q4(a.Bd,b).Ke(function(a){var e=a.cr(),g=void 0;e?(g=this.Bd.mE(e),e=g.Fa(),g=z.y(g,"endIndex")):(e=0,g=a.Ca().length);c.push({anchor:b,startIndex:e,endIndex:g,notes:[a],quotes:[],aj:[]})},a);if(a.mR)return c;(a.zc.Ln[b]||[]).forEach(function(a){var e=
t5(a);c.push({anchor:b,startIndex:e.startIndex,endIndex:e.endIndex,notes:[],quotes:[a],aj:[]})},a);A4(a.Bg,b).forEach(function(a){var e=y4(a);e&&(e=z4(e)&&z4(e).Vk())&&(e=t5(e),c.push({anchor:b,startIndex:e.startIndex,endIndex:e.endIndex,notes:[],quotes:[],aj:[a]}))},a);return c},Koa=function(a,b){var c=[];b.sort(function(a,b){return a.startIndex-b.startIndex});b.forEach(function(a){var b=z.Ra(c,function(b){return b.endIndex>=a.startIndex-1&&b.startIndex<=a.endIndex+1});0<=b?this.Qw(c[b],a):c.push(a)},
a);return c},q5=function(a,b){var c=[];b.forEach(function(a){if(a.offsetTop){var b=z.Ra(c,function(b){return 30>=Math.abs(b.offsetTop-a.offsetTop)});0<=b?this.Qw(c[b],a):c.push(a)}},a);return c},r5=function(a,b){a.Va(".js-paragraphControl-"+b).forEach(z.xg);a.pf[b]=a.pf[b].map(function(a){var b=Moa(this,a),b=z.hw(Noa,b);b.style.top=a.offsetTop+"px";a.oa=b;this.V().appendChild(a.oa);z.t(b,"is-visible");return a},a)},Moa=function(a,b){var c=b.notes,d=b.aj,e=x4(a.zc,b.quotes),g=d?d.length:0,h=c?c.length:
0,k=0,n=0,p=0,v=!1,u=!1,E={},M={},O=z.Kk().userId,S=a.Ba.Sa().ge().Oa();c.forEach(function(a){var b=a.zu();b&&((a=C4(a))&&a.forEach(function(a){h++;a.author&&(a.author.userId==O&&k++,a.author.social&&a.author.social.isFollowing&&(E[a.author.userId]=a.author),M[a.author.userId]=!0)}),M[b.userId]=!0,b.userId==O&&k++,b.userId==S?n++:p++,b.social&&b.social.isFollowing&&(E[b.userId]=b))});e.forEach(function(a){a=a.user;M[a.userId]=!0;a.userId==O&&(v=!0);a.social&&a.social.isFollowing&&(E[a.userId]=a)});
d.forEach(function(a){a=a.ge();M[a.userId]=!0;a.userId==O&&(u=!0);a.social&&a.social.isFollowing&&(E[a.userId]=a)});c=b.quotes.filter(function(a){return"anon"==a.Oa()});return{postId:a.za,Kq:b.anchor,aca:h,Bca:g,Rr:u,Jr:k,tX:n,bca:p,Loa:e.length,Qr:v,aW:Object.keys(M).length,zaa:z.tb(E),Mv:c.length}},t5=function(a){var b=a.ac(),c=a.Oc();1<a.paragraphs.length&&(c=a.paragraphs[0].text.length);return{startIndex:b,endIndex:c}},p5=function(a,b){var c=z.gx();return b.map(function(a){var b=this.qd.get(a.anchor),
g=this.Ba.kg(b);if(!g)return a;var h=void 0;4==g.type&&(g.ba()&&(h=b.querySelector("figcaption")),h||(h=b));if(!h){for(var g=a.startIndex+1,b=[b],h=0,k=null;0<b.length&&h<g;)if(k=b.pop(),!(k.nodeName in z.lT))if(3==k.nodeType)var n=k.nodeValue.replace(/(\r\n|\r|\n)/g,"").replace(/ +/g," "),h=h+n.length;else if(k.nodeName in z.mT)h+=z.mT[k.nodeName].length;else for(n=k.childNodes.length-1;0<=n;n--)b.push(k.childNodes[n]);h=k}g=z.kx(h,!0);a.offsetTop=Math.round(g.top+c.top);return a},a)},Noa=function(a,
b,c){b=z.C;var d='\x3cdiv class\x3d"paragraphControls js-paragraphControl js-paragraphControl-'+z.J(a.Kq)+' u-noUserSelect"\x3e',e=z.C,g;if(a.aca||a.Bca){g='\x3cdiv class\x3d"notesMarker u-noUserSelect" data-action\x3d"select-anchor" data-action-value\x3d"'+z.J(a.Kq)+'"\x3e';var h;h={size:"19px"};var k="19px"==h.size?1:0;h=""+(k?z.Yz(z.F(h,{name:"asteriskFilled",Gb:k}),c):"");h=(0,z.C)(h);g=g+z.D(h)+"\x3c/div\x3e"}else g="";h=""+(1==a.Jr?"a note":"notes");h=z.H(h);k=""+(1==a.aW&&(0<a.Jr||a.Qr||a.Rr)?
0<a.Jr&&a.Qr&&a.Rr?" highlighted, responded, and left "+h:0<a.Jr&&a.Rr?" responded and left "+h:0<a.Jr&&a.Qr?" highlighted and left "+h:a.Qr&&a.Rr?" highlighted and responded":a.Qr?" highlighted":0<a.Jr?" left "+h:a.Rr?" responded":"":"");k=z.H(k);h='\x3cspan class\x3d"paragraphControls-itemText"\x3e';c=""+(0<a.tX&&0==a.bca&&!a.Qr&&!a.Rr?1==a.tX?"Note to self":"Notes to self":z.I(z.rS(z.F(a,{social:a.zaa,isActive:0<a.Jr||a.Qr||a.Rr,Vf:a.aW,QM:!0,ica:!0,EU:0<a.Mv?"Top highlight":""}),c))+z.D(k));c=
(0,z.P)(c);h+=z.I(z.gS(z.F(a,{text:c})))+"\x3c/span\x3e";a=(0,z.C)(h);a=e(g+a);return b(d+a+"\x3c/div\x3e")},u5=function(a,b,c){z.U.call(this);this.W=a;this.v1=a.get("floating-components");this.qa=a.get("screen");this.Ka=a.get("screen-service");this.Oh=a.get("uri-fragment");this.cb=a.get("dom-monitor");this.Ba=b;this.Gc=b.Gc;this.ri=this.Gc.querySelector(".js-postField");var d=z.rT("div","layoutSingleColumn notesPositionContainer");z.pT(this.Gc,d,0);this.mS=d;this.zc=a.get("quotes-data");this.Bd=
a.get("notes-data");this.Bd.subscribe("new_note_list",this.I4,this);this.ZB=b.Sa().qh().fE()?z.q(this.Bd.load(b.va()),this.N4,this):null;this.Bg=a.get("responses-data");this.oi=null;this.qd=new U4(this.Gc.querySelector(".js-notesSource"));this.Ow=this.pf=this.OC=null;this.pf=new m5(a,b,this.qd,this.mS);this.track(this.pf);this.Ow=this.pf.V();this.pi=this.zI=null;this.Gd=c},w5=function(a,b){if(a.isActive()){var c=(b=b||a.zI)&&b.yy,d=b&&b.noteId;c&&(a.Rn(c),d&&a.Bd.Uk(d,c)&&a.pi&&z.q(a.pi,function(){v5(this,
c,null,d)},a));uoa(a.Oh)}else a.zI=b||null},v5=function(a,b,c,d,e,g){var h={pg:!0,IM:767>=window.innerWidth};a.BJ();c=new d5(a.W,a.Ba,b,d||"",c||null,a.qd,e||null,g||null);c.subscribe("set-active-highlight",a.XS,a);c.subscribe("reset-highlight",a.h7,a);c.subscribe("close",a.BJ,a);b=g&&g.oa?g.oa:a.qd.get(b);g=z.eN(a.v1);g.Hi=b;b=g.zp(c);b.Gx=h;h=b.dG(a.wj.bind(a));h.HC=!0;a.oi=h.S()},x5=function(a,b,c){var d=a.Ba.kg(V4(a.qd,b));if(d&&4!=d.type){z.Jq(d,4);if(c){if(!Doa(c,d))return;z.Hq(d,z.Nq(c.startIndex,
c.endIndex,c.id))}c={mode:a.Ba.ed()?"edit":"view",Kg:z.is(a.Ba.Sa()),media:null,fi:null,sections:!0,ei:!1,Rh:!1,cf:!1};a.qd.get(b).innerHTML=z.Et(d,z.x,c)}},Ooa=function(a,b){var c=z.fi();if(!c||c.isCollapsed())if(b&&(c=b),!c||c.isCollapsed())return null;var d=z.eh(c),e=X4(a.qd,d);if(!e)return null;e=(d=z.Fw(d,z.SD,e))&&a.Ba.kg(d);if(!d)return null;var g=z.px(c,d,!0),h=z.px(c,d,!1);return-1==g||-1==h?null:new Eoa(c,d,new z.Ut({anchor:d.getAttribute("name"),startIndex:g,endIndex:h,content:e.ba().substring(g,
h)}))},y5=function(){},Poa=function(a,b,c){a=a||{};b=z.C;var d='\x3cdiv class\x3d"container u-size740"\x3e\x3cdiv class\x3d"responsesStreamWrapper u-size640 u-hide js-responsesStreamWrapper"\x3e\x3cdiv class\x3d"container u-size640 responsesStream-title"\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col u-xs-size12of12"\x3e'+z.I(z.LS({title:"Responses",yf:!0},c))+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";if(c.supportsEdit){var e=a;a=z.C;c.isAuthenticated?e=z.I(z.QY({pp:(0,z.P)(""+(e.post.virtuals.responsesCreatedCount?
z.I(z.GT()):z.I(z.FT())))},c)):(e=e||{},e=(0,z.C)('\x3cdiv class\x3d"responses-loggedOutPrompt js-responsesLoggedOutPrompt"\x3e'+z.I(z.MA({icon:"icon--responseBubble",ga:!0,Tb:!0,ud:(0,z.N)(""+z.K(z.ir(z.F(e,{uF:!0}),0,c))),text:(0,z.P)(""+z.I(z.GT())),H:"button--loggedOutPrompt",source:"logged_out_response_prompt"},c))+"\x3c/div\x3e"));a='\x3cdiv class\x3d"container u-size640 responsesStream-editor cardChromeless"\x3e\x3cdiv class\x3d"row"\x3e\x3cdiv class\x3d"col u-xs-size12of12"\x3e'+a(e)+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"}else a=
"";return b(d+a+'\x3cdiv class\x3d"responsesStream js-responsesStream"\x3e\x3c/div\x3e\x3cdiv class\x3d"container u-size640 u-hide js-showOtherResponses"\x3e\x3cdiv class\x3d"row"\x3e'+z.I(z.kz({action:"show-other-responses",s:(0,z.P)(""+z.I((0,z.C)("Show all responses"))),isPrimary:!0,H:"responsesStream-showOtherResponses cardChromeless u-sizeFullWidth"},c))+'\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"responsesStream js-responsesStreamOther"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e')},z5=function(a){z.U.call(this);
this.ya=a.get("screen-request");this.$=null;this.EK=a.get("screen-view-state");this.W=a;this.WJ=!1;this.cJ=this.Zc=null};z.fX.prototype.CF=z.W(363,function(a){a!=this.zB&&this.La&&(this.La.ff.contentEditable=a);this.zB=a});z.IM.prototype.TL=z.W(353,function(a){a=y4(a);if(!a)return null;a=z4(a)&&z4(a).Vk();return a?(a=a.pb())&&a.length?a[0].getName():null:null});z.uL.prototype.Uk=z.W(324,function(){return z.y(this,"note")});z.eM.prototype.Uk=z.W(323,function(a){return this.fb("Note",a)});
z.KF.prototype.dG=z.W(252,function(a){this.wj=a;return this});z.dN.prototype.dG=z.W(251,function(a){this.wj=a;return this});z.St.prototype.Ko=z.W(232,function(){return z.y(this,"replyId")});z.Wt.prototype.Ko=z.W(231,function(){return z.y(this,"replyId")});z.uL.prototype.Ko=z.W(230,function(){return z.y(this,"replyId")});z.Qt.prototype.$r=z.W(229,function(a){return z.A(this,"highlight",a)});z.Qt.prototype.mE=z.W(228,function(){return z.y(this,"highlight")});
z.Qt.prototype.Lm=z.W(227,function(a){return z.A(this,"author",a)});z.St.prototype.Lm=z.W(226,function(a){return z.A(this,"author",a)});z.GL.prototype.Lm=z.W(225,function(a){return z.A(this,"author",a)});z.Qt.prototype.zu=z.W(224,function(){return z.y(this,"author")});z.St.prototype.zu=z.W(223,function(){return z.y(this,"author")});z.GL.prototype.zu=z.W(222,function(){return z.y(this,"author")});z.Qt.prototype.cr=z.W(221,function(){return z.y(this,"highlightId")});
z.Vt.prototype.cr=z.W(220,function(){return z.y(this,"highlightId")});z.Qt.prototype.Cv=z.W(219,function(a){return z.A(this,"authorId",a)});z.St.prototype.Cv=z.W(218,function(a){return z.A(this,"authorId",a)});z.Qt.prototype.hs=z.W(217,function(a){return z.A(this,"state",a)});z.St.prototype.hs=z.W(216,function(a){return z.A(this,"state",a)});z.yL.prototype.hs=z.W(215,function(a){return z.A(this,"state",a)});z.Qt.prototype.Wd=z.W(214,function(){return z.y(this,"noteId")});
z.St.prototype.Wd=z.W(213,function(){return z.y(this,"noteId")});z.Vt.prototype.Wd=z.W(212,function(){return z.y(this,"noteId")});z.Wt.prototype.Wd=z.W(211,function(){return z.y(this,"noteId")});z.uL.prototype.Wd=z.W(210,function(){return z.y(this,"noteId")});z.Kt.prototype.Vk=z.W(209,function(){return z.y(this,"quote")});z.MK.prototype.Vk=z.W(208,function(){return z.y(this,"quote")});z.UK.prototype.Vk=z.W(207,function(){return z.y(this,"quote")});
z.uL.prototype.Vk=z.W(206,function(){return z.y(this,"quote")});z.fm.prototype.Ez=z.W(174,function(a){return z.A(this,"inResponseToPostId",a)});z.TY.prototype.Ez=z.W(173,function(a){this.aq=a;return this});z.ml.prototype.vE=z.W(158,function(){return z.y(this,"point")});E4.prototype.vE=function(){var a=window.document.body;return z.Fg(a,this.Ef.node)?this.Ef:this.Bh&&z.Fg(a,this.Bh)?z.qx(this.aC,this.Bh):this.Vc&&(a=z.Rw(this.s1,this.Vc))?z.qx(this.aC,a):null};z.m(F4,z.ah);
F4.prototype.rz=function(){if(!this.bh)return null;var a=this.bh.vE();if(!a)return null;var b=this.wi.vE();return b?z.Qh(a.node,a.offset,b.node,b.offset):null};z.m(G4,z.U);z.f=G4.prototype;z.f.nh=function(){return this.pk.nh()};
z.f.U=function(){G4.C.U.call(this);z.ly(this,this.LH,"data-redirect-type-quote",this.X3,this);this.la(this.Gc,"click",this.Bw,this);z.ZH(this.Ba)&&z.kw()&&this.la(this.Gc,"mouseover",this.b2,this);this.Ba.Sa().km()&&!this.Ba.ed()&&z.r(this.zc.load(this.Ba.va()),z.T);var a=this.nh();a&&(z.ly(this,a,"quote",this.W1,this),z.ly(this,a,"quote-respond",this.X1,this),z.ly(this,a,"show",this.vK,this),z.ly(this,a,"hide",this.s4,this))};
z.f.X3=function(a){var b=z.RH(this.pk,this.nh().Bq);b&&(a.url=new z.Bd(z.w(this.l,z.DP,{postId:this.Ba.va()},{paragraphs:JSON.stringify([b.qr.bb().nb()]),startOffset:b.start,endOffset:b.end})))};z.f.Bw=function(a){z.Fw(a.target,function(a){if(a===this.Gc)return!0;var c=z.ZD(a);if(3==c)return!0;if(7==c){if(c=L4(this,a))if(I4(this,c),z.kw())N4(this,c);else{var d=new z.uF;J4(this,c,a,d)}return!0}return!1}.bind(this))};
z.f.b2=function(a){z.Fw(a.target,function(a){if(a===this.Gc)return!0;var c=z.ZD(a);if(3==c)return!0;if(7==c){c=z.fi();if(!(c&&!c.isCollapsed()||this.nh()&&this.nh().Yi())&&(c=L4(this,a))){var d=this.Gc.querySelector('.markup--quote[name~\x3d"'+c.mg()+'"]');a=new z.wF(a,100);J4(this,c,d,a);I4(this,c)}return!0}return!1}.bind(this))};
z.f.vK=function(){var a=z.fi();a&&!a.isCollapsed()&&I4(this,null);z.ZH(this.Ba)&&(a=z.RH(this.pk,this.nh().Bq))&&(a=z.DH(this.zc,a.qr,a.start,a.end),z.td(this.nh().pa().querySelector(".js-highlightMenuQuoteButton"),"is-active",!!a))};z.f.s4=function(){this.Xl&&I4(this,null)};
z.f.W1=function(){if(z.ZH(this.Ba)){var a=z.LH(this.nh());if(a){var b=a.range,c=a.sba,d=z.od(this.nh().pa().querySelector(".js-highlightMenuQuoteButton"),"is-active"),a=z.RH(this.pk,b);z.r(z.q(this.zc.toggle(a.qr,a.start,a.end,!c),function(a){z.jT();d?z.NH(this.nh()):N4(this,a);var b=c?"selection_menu":"quote_click_menu";O4(this,a.mg(),!d,b)},this),z.T)}}};
z.f.X1=function(){if(z.ZH(this.Ba)&&z.x.supportsEdit){var a=z.LH(this.nh());if(a){var b=z.RH(this.pk,a.range);z.r(z.q(this.zc.create(b.qr,b.start,b.end,1,!0),function(a){O4(this,a.mg(),!0,"selection_menu_quote_respond");this.X("quote-respond",a,b.qr.name)},this),z.T)}}};
z.f.i2=function(a){var b=this.Xl,c=K4(this,b),d=b.ac(),e=b.Oc(),b=a.query(".js-quoteAttributions-pileOn"),g=z.od(b,"is-active");z.r(z.q(this.zc.toggle(c,d,e,!0),function(b){var k=a.query(".js-quoteAttributions-pileOn");z.wd(k,"is-active");if(k=z.EH(this.zc,c,d,e)){var n=H4(this,k),p=a.query(".js-quoteAttributions-info");z.R(p,D4,n)}else a.Ib();!g&&z.kw()&&(a.Ib(),N4(this,k));k=z.kw()?"quote_hover":"quote_click_mobile";O4(this,b.mg(),!g,k)},this),z.T)};
z.f.j2=function(){if(z.ZH(this.Ba)&&z.x.supportsEdit){var a=K4(this,this.Xl),b=this.Xl.ac(),c=this.Xl.Oc();z.r(z.q(this.zc.create(a,b,c,1,!0),function(b){O4(this,b.mg(),!0,"quote_respond");this.X("quote-respond",b,a.name)},this),z.T)}};
z.f.OS=function(){var a=new F4(this.Gc),b=this.zc.Ln,c=Object.keys(b).concat(this.dQ);z.eb(c);c.forEach(function(a){var c=b[a]||[],g=this.Ba;if(g=(a=g.Gc&&z.Rw(g.Gc,a))&&this.Ba.kg(a))yoa(g,c),a.innerHTML=z.Et(g,z.x,z.WH(this.Ba)),z.tN(this.z6,a)},this);this.dQ=Object.keys(b);(a=a.restore())&&a.select()};z.m(P4,z.iy);z.f=P4.prototype;z.f.load=function(a){this.za=a;this.ui||(this.ui=z.r(z.q(this.tk.get(z.w(this.l,z.Cga,{postId:a}),{json:!0,background:!0}),this.x6,this),z.T));return this.ui.Vb()};
z.f.gl=function(){return this.bQ};z.f.Pu=function(){return this.tS};z.f.mE=function(a){return this.ZQ[a]||null};z.f.Uk=function(a,b){return z.OR(Q4(this,b),a)};z.f.$r=function(a,b){this.ZQ[a]=b};z.f.va=function(){return this.za};
z.f.x6=function(a){var b=a.references.User;this.tS=a.post.visibility;var c=a.value;if(c)for(var d=0;d<c.length;d++){var e=c[d];if("HIDDEN"!=e.state){var g=e.replies,h=b;if(g)for(var k=0;k<g.length;k++){var n=g[k],p=n.authorId||null;n.author=p&&h[p]||null}g=e.anchor;h=e.authorId||null;e.author=h&&b[h]||null;g=Q4(this,g);e=z.Rt(e);g.add(z.iH(this.Z,e))}}if(a=a.highlights)for(b=0;b<a.length;b++)this.$r(a[b].id,z.Xj.bb(z.Ut,a[b]));this.bQ=!0};T4.prototype.MD=function(a,b,c){return new G4(a,b,c)};U4.prototype.get=function(a){return V4(this,a)};z.m(Y4,z.fX);z.f=Y4.prototype;z.f.vx=!1;z.f.ft="";z.f.wx=0;z.f.bp=z.V;z.f.Wd=function(){return this.OI};z.f.save=function(){this.Ca().length<=this.Di&&this.vq()};z.f.Da=function(){(0,window.clearTimeout)(this.wx);Y4.C.Da.call(this)};z.f.U=function(){function a(a){a.stopPropagation()}Y4.C.U.call(this);this.ft=this.Ca();this.Qd(this.ft);this.du(13,this.SI,this);this.du(27,this.TI,this);this.La.la("blur",this.RI,!1,this);var b=this.La.pa();z.Vw(b,"keydown",a);z.Vw(b,"keyup",a);z.Vw(b,"keypress",a)};
z.f.HN=function(a){return a};z.f.vq=function(){if(this.isEnabled()){var a=this.Ca().trim();if(a){this.CF(!1);var b=this.tV(),a=this.sV(a);this.X("saving",a);z.Xc(z.r(z.q(this.tk.post(b,a.nb(),{json:!0}),this.M4,this),this.K4.bind(this,a)),this.CF.bind(this,!0))}}};z.f.M4=function(a){this.X("save",this.HN(a.value))};z.f.K4=function(a,b){this.X("fail",a);this.aa.error((0,z.C)("Saving failed. You may be having connectivity issues or notes might be disabled on this post. Please try again."));z.T(b)};
z.f.SI=function(a){if(this.Mx&&this.Mx.il())return!1;a.shiftKey||(a.preventDefault(),this.save());return!0};z.f.TI=function(a){if(this.Mx&&this.Mx.il())return!1;a.preventDefault();this.Qd(this.ft);this.X("cancel");return!1};z.f.RI=function(){this.vx&&(this.Ca().length>=this.Di?(0,window.confirm)(this.wV())?(this.Qd(this.ft),this.X("cancel")):this.focus():this.wx=(0,window.setTimeout)(this.vq.bind(this),100))};z.m(Z4,Y4);z.f=Z4.prototype;z.f.FG=null;z.f.DP=null;z.f.GG=null;z.f.Vg=null;z.f.dI=null;z.f.cI=null;z.f.YQ=null;z.f.$r=function(a){this.Vg=a;this.dI=a.startIndex;this.cI=a.endIndex;this.YQ=a.content;return this};z.f.wV=function(){return(0,z.C)("Your note is too long; do you want to abandon your changes?")};z.f.HN=function(a){var b=z.fw();a=z.Rt(a).Lm(b).Cv(b.Oa());this.Vg&&a.cr()&&this.Bd.$r(a.cr(),this.Vg);var b=this.Bd,c;c=z.iH(b.Z,a);Q4(b,c.ad()).add(c);return a};
z.f.tV=function(){return this.Wd()?z.w(this.l,z.Dga,{postId:this.za,noteId:this.Wd()}):z.w(this.l,z.Bga,{postId:this.za})};z.f.sV=function(a){var b=z.fw();a=(new z.Qt({content:a,anchor:this.FG,anchorContent:this.DP,anchorImage:this.GG?this.GG.nb():null,replies:[],createdAt:Date.now()})).Lm(b);null!=this.dI&&null!=this.cI&&(b=new z.Ut({anchor:this.FG,startIndex:this.dI,endIndex:this.cI,content:this.YQ}),a.$r(b));return a};z.m($4,Y4);$4.prototype.wV=function(){return(0,z.C)("Your reply is too long; do you want to abandon your changes?")};$4.prototype.HN=function(a){var b=z.fw();a=z.Tt(a).Lm(b).Cv(b.Oa());C4(this.Bd.Uk(a.Wd(),this.Vc)).push(a);return a};$4.prototype.tV=function(){return this.KS?z.w(this.l,z.Gga,{postId:this.za,noteId:this.Wd(),replyId:this.KS}):z.w(this.l,z.Fga,{postId:this.za,noteId:this.Wd()})};
$4.prototype.sV=function(a){var b=z.fw();return(new z.St({replyId:"",postId:this.za,noteId:this.Wd(),content:a,createdAt:Date.now()})).Lm(b)};z.m(d5,z.U);z.f=d5.prototype;
z.f.U=function(){d5.C.U.call(this);z.Ly(this.V()).o("show-note-editor",this.XJ,this).o("hide-note-editor",this.$H.bind(this,!0)).o("show-reply-editor",this.o8,this).o("hide-reply-editor",this.E2,this).o("save-note",this.t7,this).o("save-reply",this.v7,this).o("highlight-quote",this.I2,this).o("dismiss-note",this.gQ.bind(this,!0),this).o("delete-note",this.gQ.bind(this,!1),this).o("delete-reply",this.Q0,this).o("previous-highlight-tip",this.v6,this).o("next-highlight-tip",this.z3,this);f5(this);this.Bg&&
w4(this.Bg)&&(e5(this),z.ly(this,w4(this.Bg),"add",this.J4,this));if(this.uJ&&this.hR&&this.iR){var a=this.query(".js-inlineNewPostControl"),b=this.uJ,c=this.Ba.va(),d=new z.TY(this.W);d.zz("web-inline-quote-responses");d.Wa(a);d.ow=!0;d.mH=!0;d.kH=!0;d.dD=zoa;d.bq=b;d.Ez(c);d.zx=!0;this.Zc=d;this.Zc.S();a=k5(this.lx);this.X("set-active-highlight",this.Vc,a)}this.Vg&&(this.XJ(),this.Ud&&this.Ud.focus());l5(this,0)};
z.f.ea=function(){this.Jl&&this.Jl.uL();(this.Vg||this.lx)&&this.X("reset-highlight",this.Vc,null);d5.C.ea.call(this)};z.f.Da=function(){z.My(this.V());z.xg(this.V());z.fe(this.Zc);z.fe(this.Ud);z.fe(this.Jl);z.ge(z.tb(this.ah));this.Jl=this.ah=this.Ud=this.Zc=null;d5.C.Da.call(this)};z.f.Ro=function(){if(this.Ud&&this.Ud.Ca())return!0;for(var a=z.tb(this.ah),b=0;b<a.length;b++)if(a[b]&&a[b].Ca())return!0;return this.Zc&&!this.Zc.isDismissable()?!0:!1};
z.f.WG=function(){var a=[],b=[],c=[],d=this.kt&&(this.Vg||this.lx);d||(this.fq?(a=this.zc?x4(this.zc,this.fq.quotes):[],b=this.fq.notes,c=this.fq.aj):(b=this.Bd?z.BH(Q4(this.Bd,this.Vc)):[],this.OI||(this.zc?(a=this.zc,a=x4(a,a.Ln[this.Vc]||[])):a=[],c=this.Bg?A4(this.Bg,this.Vc):[])));return z.hw(Goa,{post:this.Ba.Sa(),quotes:a,notes:b,aj:c,OO:!!this.uJ,JF:d,Mz:this.kt,Mv:this.yT,cca:z.YH(this.Ba)})};
z.f.J4=function(){var a=this.query(".js-blockGroupPosts"),b=z.hw(a5,{aj:A4(this.Bg,this.Vc)});z.yg(b,a);e5(this)};
z.f.XJ=function(){if(this.kt){if(!this.Ud){var a=this.query(".js-noteEditor"),b=String(z.gw(Foa)),a=this.Ud=new Z4(this.W,a,this.Ba.va(),null,b),b=this.Vc,c=this.Ba.kg(this.qd.get(this.Vc)),d=c.ba(),c=4==c.type?c.nd():null;a.FG=b;a.DP=d;a.GG=c;(a=this.Vg)&&this.Ud.$r(a);z.ly(this,this.Ud,"saving",this.n5,this);z.ly(this,this.Ud,"fail",this.p4,this);z.ly(this,this.Ud,"save",this.i5,this)}z.t(this.query(".js-noteActions"),"is-noteEditorVisible");this.Ud&&this.Ud.focus()}};
z.f.t7=function(){this.Ud&&this.Ud.save()};z.f.n5=function(a){this.Ud.Qd("");var b=this.query(".js-notesList");a={note:a,post:this.Ba.Sa(),JF:this.kt,Mz:this.kt};a=z.hw(b5,a);b.appendChild(a);z.rd(b,"is-empty");f5(this);this.$H()};z.f.i5=function(a){var b=this.query(".js-notesList").lastChild;a=a.Wd();z.t(b,"js-note-"+a);b.setAttribute("data-note-id",a);(b=b.querySelector(".js-deleteNote"))&&b.setAttribute("data-action-value",a)};
z.f.p4=function(){var a=this.query(".js-notesList");a.removeChild(a.lastChild);z.t(a,"is-empty");this.XJ()};z.f.$H=function(a){a?this.X("close"):this.Ud&&(this.Ud.Ca()&&this.Ud.Qd(""),z.rd(this.query(".js-noteActions"),"is-noteEditorVisible"))};z.f.o8=function(a){(a=j5(a.target))&&this.kt&&g5(this,a)};z.f.v7=function(a){a=j5(a.target);(a=this.ah[a])&&a.save()};
z.f.o5=function(a){var b=a.Wd();this.ah[b]&&this.ah[b].Qd("");var c=this.Bd.Uk(b,this.Vc).author.userId==a.author.userId,d=this.query(".js-note-"+a.Wd()+" .js-repliesList");a={note:a,post:this.Ba.Sa(),wW:c};a=z.hw(b5,a);d.appendChild(a);z.rd(d,"is-empty");h5(this,b)};z.f.j5=function(a){var b=this.query(".js-note-"+a.Wd()).querySelector(".js-repliesList").lastChild;a=a.Ko();z.t(b,"js-reply-"+a);(b=b.querySelector(".js-deleteNote"))&&b.setAttribute("data-action-value",a)};
z.f.q4=function(a){var b=this.query(".js-note-"+a.Wd()+" .js-repliesList");b.removeChild(b.lastChild);z.t(b,"is-empty");g5(this,a.Wd())};z.f.E2=function(a){(a=j5(a.target))&&h5(this,a)};z.f.I2=function(a){a=a.target;var b=a.getAttribute("data-quote-creator-id"),c=V4(this.qd,this.Vc);c&&(this.Jl&&this.Jl.uL(),this.Jl=Ioa(this,c,a,function(){i5(this,b,!1);z.fe(this.Jl);this.Jl=null}),i5(this,b,!0))};
z.f.G2=function(a){var b=V4(this.qd,this.Vc);(a=this.Bd.Uk(a.target.getAttribute("data-note-id"),this.Vc))&&b&&(b=(b=a.cr())?this.Bd.mE(b):null,this.X("set-active-highlight",this.Vc,b))};z.f.J2=function(a){var b=V4(this.qd,this.Vc),c;c=this.Bg;a=a.target.getAttribute("data-post-id");c=w4(c)?z.OR(w4(c),a):null;b&&c&&(b=y4(c))&&(b=z4(b)&&z4(b).Vk())&&(c=b.pb())&&c.length&&(b=k5(b),this.X("set-active-highlight",this.Vc,b))};
z.f.uK=function(){var a=null;this.lx&&(a=k5(this.lx));this.Vg&&(a=this.Vg);this.X("reset-highlight",this.Vc,a)};
z.f.gQ=function(a,b){var c=b.value,d=this.Bd.Uk(c,this.Vc),e=this.query(".js-note-"+c);if(d&&e){z.OT(e);this.uK();this.Va(".js-note-item").every(function(a){return z.od(a,"u-hide")})&&this.$H(!0);var g=R4(this.Bd,d,"HIDDEN");z.r(g.Sh,function(b){this.fa.S(a?(0,z.C)("Yikes! Something happened and we couldn’t dismiss this note."):(0,z.C)("Yikes! Something happened and we couldn’t delete this note."),"error");g.sz();z.Tw(e);(400>b.status||499<b.status)&&R4(this.Bd,d,"NEW")},this);z.q(this.fa.S(a?(0,z.C)("The note has been dismissed."):
(0,z.C)("The note has been deleted."),{type:"success",Nv:!0}),function(){this.fa.Ib();g.sz();R4(this.Bd,d,"NEW");z.Tw(e)},this)}};
z.f.Q0=function(a){var b=a.value,c=this.query(".js-reply-"+b),d=j5(a.target);if(d&&c){z.OT(c);var e=S4(this.Bd,b,d,this.Ba.va(),this.Vc,"HIDDEN");z.r(e.Sh,function(){this.fa.S((0,z.C)("Yikes! Something happened and we couldn’t delete this reply."),"error");e.sz();z.Tw(c);S4(this.Bd,b,d,this.Ba.va(),this.Vc,"")},this);z.q(this.fa.S((0,z.C)("The reply has been deleted."),{type:"success",Nv:!0}),function(){this.fa.Ib();e.sz();S4(this.Bd,b,d,this.Ba.va(),this.Vc,"");z.Tw(c)},this)}};
z.f.v6=function(){l5(this,this.mB-1)};z.f.z3=function(){l5(this,this.mB+1)};z.m(m5,z.U);z.f=m5.prototype;z.f.U=function(){m5.C.U.call(this);var a=[];z.YH(this.Ba)&&a.push(this.Bd.load(this.za));this.mR||(a.push(this.zc.load(this.za)),a.push(this.Bg.load(this.za)));this.Sp=z.q(z.q(z.q(z.lF(a),function(){this.Sp=null},this),this.rF,this),this.e0,this);z.ly(this,this.cb,"resize-end",this.tg,this)};z.f.ea=function(){this.Sp&&this.Sp.cancel();m5.C.ea.call(this)};z.f.Da=function(){this.Sp=null;m5.C.Da.call(this)};z.f.rF=function(){W4(this.qd,function(a,b){n5(this,b)},this)};
z.f.tg=function(){W4(this.qd,function(a,b){s5(this,b)},this)};z.f.e0=function(){var a=this.zc.$g;z.ly(this,a,"add",this.fS,this);z.ly(this,a,"remove",this.fS,this);(a=w4(this.Bg))&&z.ly(this,a,"add",this.f5,this)};z.f.fS=function(a){o5(this,Object.keys(z.HH(this.zc,a instanceof Array?a:[a])))};z.f.f5=function(a){o5(this,(a instanceof Array?a:[a]).map(this.Bg.TL,this.Bg))};z.f.WG=function(a){var b=window.document.createElement("div");b.className="notesMarkers";a.appendChild(b);return b};
z.f.Qw=function(a,b){z.Db(a,{startIndex:Math.min(a.startIndex,b.startIndex),endIndex:Math.max(a.endIndex,b.endIndex),notes:a.notes.concat(b.notes),quotes:a.quotes.concat(b.quotes),aj:a.aj.concat(b.aj)})};z.m(u5,z.U);z.f=u5.prototype;z.f.U=function(){u5.C.U.call(this);this.la(this.qa.V(),"click",this.j3,this,!0);z.Ly(this.Ow).o("select-anchor",this.p5,this);var a=this.Ba.Sa();if(a.km()&&!this.Ba.ed()){var b=z.hm(a),b=2==a.visibility&&b&&!z.yl(b.qh());a.allowResponses&&!b&&z.r(this.Bg.load(this.Ba.va(),"best"),z.T);z.r(this.zc.load(this.Ba.va()),z.T)}this.zI&&w5(this);z.ly(this,this.Ka,"historyUpdate",function(){w5(this,z.dJ())},this);this.Gd&&z.ly(this,this.Gd,"highlight",this.L4,this)};
z.f.Da=function(){z.fe(this.pf);this.pf=null;z.fe(this.oi);this.oi=null;this.Ow&&z.Ly(this.Ow).clear("select-anchor");this.ZB&&this.ZB.cancel();this.ZB=null;u5.C.Da.call(this)};z.f.fca=function(a,b){v5(this,b,null,null,a)};z.f.zda=function(){this.pf&&this.pf.tg()};z.f.Ro=function(){if(!this.oi)return!1;var a=this.oi.Ca();return a?a.Ro():!1};z.f.I4=function(a){a.subscribe("add",this.GT,this);a.subscribe("remove",this.GT,this)};
z.f.GT=function(a){(z.ga(a)?a:[a]).forEach(function(a){n5(this.pf,a.ad())},this)};z.f.N4=function(){var a=(0,z.Ja)();this.ZB=null;w5(this,z.dJ());this.la(this.ri,z.NO,this.aJ,this);z.NB("notes.renderMarkers",(0,z.Ja)()-a)};z.f.aJ=function(a){(a=a.target.getAttribute("name"))&&V4(this.qd,a)&&s5(this.pf,a)};z.f.L4=function(){if(this.Gd){var a=Ooa(this,this.Gd.Bq);z.NH(this.Gd);a&&(a=a.highlight,this.XS(a.anchor,a),v5(this,a.anchor,a))}};
z.f.j3=function(a){if(this.oi){var b=a.target;if(!z.Fg(this.oi.V(),b)){var c=this.oi.Ca(),d;if(!(d=!c)){a:if(c.Ud&&c.Ud.Ca())c=!0;else{d=z.tb(c.ah);for(var e=0;e<d.length;e++)if(d[e]&&d[e].Ca()){c=!0;break a}c=c.Zc&&!c.Zc.og()?!0:!1}d=!c}d&&(c=this.oi&&this.oi.Hi,d="select-anchor"==b.getAttribute("data-action"),this.BJ(),c&&d&&z.Fg(c,b)&&a.stopPropagation())}}};
z.f.wj=function(a){if(!(767>=window.innerWidth)){var b=a.Hi,c=z.kx(b);a.Vh();a=a.V();var d=z.kx(a),e=window.innerHeight,g=window.innerWidth,h=this.qa.query(".js-metabar"),k=0;h&&(k=z.kx(h).height);d.height>=e-k?z.t(a,"floating--sidebar"):(h=z.fx(b),h=c.top+d.height>=e?z.gx().top+e-d.height-10:z.fx(b),b=z.kx(this.Ow).left+10,b+d.width>=g&&(b=g-d.width-10),a.style.top=h+"px",a.style.left=b+"px")}};z.f.BJ=function(){z.fe(this.oi);this.oi=null};
z.f.p5=function(a){var b=z.Fw(a.target,function(a){return z.od(a,"js-paragraphControl")},this.mS),b=Loa(this.pf,a.value,b);v5(this,a.value,null,null,null,b)};z.f.XS=function(a,b){if(this.Ba.ed()){var c=z.fi();this.OC=(c=c&&X4(this.qd,z.eh(c)))&&new F4(c)}x5(this,a,b)};z.f.h7=function(a,b){x5(this,a,b);if(this.Ba.ed()&&this.OC){var c=this.OC.restore();c&&c.select()}this.OC=null};
z.f.Rn=function(a){if(this.qd&&(a=V4(this.qd,a))){a=Math.max(z.fx(a),0);var b=window.document.body;this.pi&&this.pi.cancel();this.pi=new z.mF(b,"scrollTop",600,a)}};y5.prototype.MD=function(a,b,c){return new u5(a,b,c)};z.ca(z5,z.U);z.f=z5.prototype;z.f.jf=function(a){this.$=a};z.f.Rca=function(a){this.WJ=a};z.f.U=function(){this.V()?(z.U.prototype.U.call(this),z.Ly(this.V()).o("show-other-responses",this.kT,this),z.R(this.V(),Poa,{post:this.$}),this.$.km()&&z.r(z.q(z.q(z.q(B4(this.ya,this.$.Ga(),"best"),this.IS.bind(this,"best")),this.W6,this),function(){this.EK.oO&&this.kT()},this),z.T)):z.T("Attempted to initialize ResponsesStreamControl without root element.")};
z.f.ea=function(){z.Ly(this.V()).clear("show-other-responses");z.U.prototype.ea.call(this)};z.f.IS=function(a,b){if(this.isActive()){var c=b.Uj,d=void 0;"best"==a?(d=this.query(".js-responsesStream"),z.ly(this,c,"add",this.NR.bind(this,c)),this.NR(c)):d=this.query(".js-responsesStreamOther");c&&(z.cl()||0<c.bd())&&d&&(z.R(d,z.GY,{items:z.BH(c),context:2}),c=new z.jZ(this.W,c),c.Wa(d),c.bj(2),this.track(c),z.Tw(this.query(".js-responsesStreamWrapper")))}};
z.f.W6=function(){var a=this.query(".js-inlineNewPostControl"),b=this.query(".js-responsesLoggedOutPrompt");if(z.cl())if(a){var b=(new z.TY(this.W)).zz("web-inline-post-response").Ez(this.$.Ga()),c=z.gw(z.ir,{post:this.$,uF:!0});b.qC=c;b.zx=this.WJ;this.Zc=b.Wa(a);this.track(this.Zc)}else b&&this.WJ&&(a=z.ex(b),b=z.fx(b),z.cx(a,0,b));else b&&z.t(b,"u-hide")};
z.f.kT=function(){this.cJ||(this.cJ=z.Xc(z.q(z.q(B4(this.ya,this.$.Ga(),"other"),this.IS.bind(this,"other")),function(){z.OT(this.query(".js-showOtherResponses"));this.EK.oO=!0},this),function(){this.cJ=null},this))};z.f.NR=function(a){(a=a.Fi)&&a.next&&"other"==a.next.filter&&!this.EK.oO&&(z.Tw(this.query(".js-responsesStreamWrapper")),z.Tw(this.query(".js-showOtherResponses")))};z.f.xu=function(){this.Zc&&(z.mx(this.Zc.V(),new z.li(60,0,200,0)),this.Zc.xu())};var A5=z.jB;A5.xa().scope("screen").add("quotes",T4).add("quote-responses",y5).add("responses-stream-control",z5).add("notes-data",P4);z.QR(A5,"notes");}).call(this, _mdm);
//# sourceURL=fingerprint:notes
